import shelve, os, re
import functions
reload(functions)
d = 2
def natsort(list_):
    # decorate
    tmp = [ (int(re.search('\d+', i).group(0)), i) for i in list_ ]
    tmp.sort()
    # undecorate
    return [ i[1] for i in tmp ]

files = os.listdir(str(d)+"D/")
files = filter(lambda x : re.match(".*shelf$", x), files)
files = natsort(files)

files = ["4.shelf"]


figure()

gammasextr = np.linspace(1,1.5,1000)
gammasextr = np.linspace(.5,1.5,1000)
if d == 3:
    gammasextr = np.linspace(.7,1.1,1000)

for file in files:
    shelf = shelve.open(str(d) + "D/" + file)
    Cgammaextr = functions.extrap(gammasextr, shelf["gammas"],shelf["Cgamma"])

    # p = polyfit(shelf["gammas"],shelf["Cgamma"], 1)
    # Cgammaextr = polyval(p,gammasextr)
    
    plot(gammasextr,Cgammaextr)
legend(map(lambda s : s.replace(".shelf",""),files))
plot(gammasextr,ones_like(gammasextr), 'k', linewidth=2)

# for file in files:
#     shelf = shelve.open(str(d) + "D/" + file)
#     plot(shelf["gammas"], shelf["Cgamma"], 'kx')

if d == 2:
    xlim((1,1.3))
    ylim((.98,1.02))
elif d == 3:
    xlim(.84,.9)
    ylim(.99,1.01)

# pylab.rcParams.update({'text.usetex':True,
#                        'axes.labelsize': 20,
#                        'text.fontsize': 16,
#                        'legend.fontsize': 6,
#                        'xtick.labelsize': 16,
#                        'ytick.labelsize': 16})
# xlabel('$\gamma$')
# ylabel('$R(V_\gamma)$')
# pylab.savefig('plots/{}D_R.pdf'.format(d))
# show()
